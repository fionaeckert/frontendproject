<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="./index.css">


  <title>Doggy DJ</title>
</head>
<div class="titleBox">Welcome to Doggy DJ!</div>

<body onload="getSongs()">

  <div class="structure">
    <div id="dogFact"></div>
    <div class="gifBox">
      <div class="gif">
        <iframe src="" frameborder="0" id="gifSpot" style="pointer-events: none;" width="480" height="288"
          frameBorder="0" class="giphy-embed"></iframe>
      </div>
    </div>

    <div class="card">

      <div class="card-header" id="nowPlaying">
        Now Playing:
      </div>

      <div class="card-body">

        <h5 class="card-title"></h5>
        <p class="card-text"></p>

        <div class="player">
          <img class="vinylImage" src="./vinyl.png" alt="">
          <a href="#" class="btn btn-primary" id="previousButton" onclick="prevSong()">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
              class="bi bi-skip-backward-btn-fill" viewBox="0 0 16 16">
              <path
                d="M0 12V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm11.21-6.907L8.5 7.028V5.5a.5.5 0 0 0-.79-.407L5 7.028V5.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0V8.972l2.71 1.935a.5.5 0 0 0 .79-.407V8.972l2.71 1.935A.5.5 0 0 0 12 10.5v-5a.5.5 0 0 0-.79-.407z" />
            </svg>
          </a>

          <a href="#" class="btn btn-primary" id="playButton" onclick="playSong()">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
              class="bi bi-file-play-fill" viewBox="0 0 16 16">
              <path
                d="M12 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM6 5.883a.5.5 0 0 1 .757-.429l3.528 2.117a.5.5 0 0 1 0 .858l-3.528 2.117a.5.5 0 0 1-.757-.43V5.884z" />
            </svg>
          </a>

          <a href="#" class="btn btn-primary" id="pauseButton" onclick="pauseSong()">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
              class="bi bi-pause-btn-fill" viewBox="0 0 16 16">
              <path
                d="M0 12V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm6.25-7C5.56 5 5 5.56 5 6.25v3.5a1.25 1.25 0 1 0 2.5 0v-3.5C7.5 5.56 6.94 5 6.25 5zm3.5 0c-.69 0-1.25.56-1.25 1.25v3.5a1.25 1.25 0 1 0 2.5 0v-3.5C11 5.56 10.44 5 9.75 5z" />
            </svg>
          </a>

          <a href="#" class="btn btn-primary" id="skipButton" onclick="nextSong()">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
              class="bi bi-fast-forward-btn-fill" viewBox="0 0 16 16">
              <path
                d="M0 4v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2Zm4.271 1.055a.5.5 0 0 1 .52.038L8 7.386V5.5a.5.5 0 0 1 .79-.407l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 8 10.5V8.614l-3.21 2.293A.5.5 0 0 1 4 10.5v-5a.5.5 0 0 1 .271-.445Z" />
            </svg>
          </a>

        </div>

      </div>

    </div>

    <div class="footer">
      <footer class="footer-contents">Created by:
        <a href="http://linkedin.com/in/jordanboardman/">Jordan,</a>
        <a href="http://www.linkedin.com/in/jonathan-batalla-2b2052249/">Jonathan</a>, and
        <a href="http://www.linkedin.com/in/fiona-eckert/">Fiona</a>
      </footer>
    </div>

  </div>

  <script src="./node_modules/howler/src/howler.core.js">

    // const {Howl, Howler} = require('howler');
    import {Howl, Howler} from 'howler';

    var sound = new Howl({
      src: ['sound.webm', 'sound.mp3']
    });

    gifsList = ['https://giphy.com/embed/rdAeOA3mfXomQ','https://giphy.com/embed/vhkPj5VZYuKKQ','https://giphy.com/embed/LWzdNsCaw2t2wdj0wp',
    'https://giphy.com/embed/XY2K8EQ83uN3sLzeYT','https://giphy.com/embed/DirPxXrUHKaCA','https://giphy.com/embed/4Zo41lhzKt6iZ8xff9','https://giphy.com/embed/3lxD1O74siiz5FvrJs'
    ,'https://giphy.com/embed/xUOxfbuK9qc61NGiaI','https://giphy.com/embed/1kkxWqT5nvLXupUTwK','https://giphy.com/embed/l2uluGTvB7DAQvZyHp','https://giphy.com/embed/VpysUTI25mTlK','https://giphy.com/embed/sy843WuhjhB5K',
    'https://giphy.com/embed/ZZAyXQIewUut2','https://giphy.com/embed/k2Da0Uzaxo9xe','https://giphy.com/embed/QV9UsDlB2tpaQpCUGn','https://giphy.com/embed/AqbzK6uE645ibue8ZJ','https://giphy.com/embed/iOdDgwtioHQaNdAQvC','https://giphy.com/embed/ZZAyXQIewUut2',
    'https://giphy.com/embed/TkBoNth0Ps3Vm','https://giphy.com/embed/oewr5qXiye6fm','https://giphy.com/embed/11lU2bLTOl26vC']
    dogFacts = []
    dogFact = ''
    playlist = []
    songInfo = []
    curIndex = 0
    preIndex = curIndex - 1 
    nexIndex = curIndex + 1
    totalLength = 20
    
    //-----------------------------------------------------------------------------------------------------------------------------------------------
    const getSongs = async() => {        // Creates an array of songs from the deezer api
        await fetch('https://djdogserver2.herokuapp.com/api.deezer.com/search?q=dog')
        .then(response => {
            return response.json()
        })
        .then(songs => {
            let songData = songs.data
            
            for(let i = 0; i < totalLength; i++)  {
                if (songData[i].explicit_lyrics == false) {
                let song = {
                    title: songData[i].title,
                    preview: songData[i].preview,
                    picture: songData[i].picture,
                    id: songData[i].id,
                    artist: songData[i].artist.name,
                    album: songData[i].album.title
                }
                songInfo.push(song)
                playlist.push(songData[i].preview)
                }
            }
            shuffle()
            startPlaylist(curIndex)

        })
    }
    //-----------------------------------------------------
    function startPlaylist(index) { // sets up the JS library (Howler) and calls the functions defined below so that the facts, songs, and gifs display properly
        sound = new Howl({
        src:[playlist[index]],
        volume: 0.1
    })
      
        sound.play()
        displaySong(songInfo[index])
        displayGif()
        getFacts()
    }
    //-----------------------------------------------------
    function playSong() {   // plays the song when the "play" button is pushed
        if (sound.playing() == false)
            sound.play()
    }
    //-----------------------------------------------------
    function pauseSong() { // pauses the song when "pause" button is pushed
        sound.pause()
    }
    //-----------------------------------------------------
    function nextSong() {   // plays the next song when "next" button is pushed
        if (nexIndex < playlist.length) {
        sound.stop()
        curIndex = nexIndex
        startPlaylist(nexIndex)
        nexIndex = curIndex + 1
        preIndex = curIndex - 1
    }
    else if (nexIndex==playlist.length){ 
        console.log('inside else if')
        sound.stop()
        curIndex = 0
        startPlaylist(curIndex)
        nexIndex = curIndex + 1
        preIndex = curIndex - 1
    }
    }
    //-----------------------------------------------------
    function prevSong() {  // plays previous song when "previous" button is pushed
        if (preIndex > -1) {
        sound.stop()
        curIndex = preIndex
        startPlaylist(preIndex)
        nexIndex = curIndex + 1
        preIndex = curIndex - 1
        }
    }

    //-----------------------------------------------------
    const displaySong = (song) => { // displays the current song in the playlist box
        document.getElementById('nowPlaying').innerText = 'Now Playing: ' + song.title + ' | ' + song.album + '\nBy: ' + song.artist
    }
    //-----------------------------------------------------
    function songDone() { // checks to see if the song is done to play next song,  missing logic for out bounds error  (something like if curIndex > playlist.length don't run)
        startPlaylist(nexIndex)
        curIndex = nexIndex
        nexIndex = curIndex + 1
        preIndex = curIndex - 1
    }
    //-----------------------------------------------------
    function shuffle() { //shuffles the list of songs called from our API
      let i = playlist.length
      let ri;
      while (i != 0) {
        ri = Math.floor(Math.random()*i);
        i--;

        [playlist[i], playlist[ri]] =  [playlist[ri], playlist[i]];
        [songInfo[i], songInfo[ri]] =  [songInfo[ri], songInfo[i]];
        [gifsList[i], gifsList[ri]] =  [gifsList[ri], gifsList[i]];
      }
    }

    //-----------------------------------------------------------------------------------------------------------------------------------------------
    function displayGif() { // places the gif within the HTML element
        document.getElementById('gifSpot').src = gifsList[curIndex]
    }
    //-----------------------------------------------------------------------------------------------------------------------------------------------
    function getFacts() { // grabs random dog fact API and calls the display function defined below
        fetch('https://djdogserver2.herokuapp.com/http://dog-api.kinduff.com/api/facts')
        .then(response => {
            return response.json()
        })
        .then(factO => {    
            dogFact = factO.facts[0]
            displayFact()
        })
    }
    //-----------------------------------------------------
    function displayFact() { // creates the function which places the random dog fact inside the HTML element
        document.getElementById('dogFact').innerText = dogFact
    }
  </script>
</body>

</html>